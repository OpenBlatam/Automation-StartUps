<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portal de Documentación - documentos_blatam</title>
  <style>
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; margin: 24px; color: #111; }
    h1 { margin: 0 0 8px; }
    .muted { color: #666; font-size: 14px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); gap: 12px; margin: 16px 0 28px; }
    .card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; background: #fff; }
    .card a { text-decoration: none; color: #2563eb; }
    .search { display: flex; gap: 8px; margin: 12px 0 6px; }
    input[type="search"] { flex: 1; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 15px; }
    .badges { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
    .badge { font-size: 12px; background: #f3f4f6; color: #374151; border: 1px solid #e5e7eb; border-radius: 999px; padding: 4px 8px; }
    .results { margin-top: 12px; }
    .result { padding: 10px 0; border-bottom: 1px dashed #eee; }
    .result a { color: #111827; text-decoration: none; }
    .result small { color: #6b7280; }
    .hint { font-size: 13px; color: #6b7280; margin-top: 6px; }
    footer { margin-top: 28px; font-size: 12px; color: #6b7280; }
  </style>
</head>
<body>
  <h1>Portal de Documentación</h1>
  <div class="muted">Navegación rápida, búsqueda y acceso a índices por carpeta</div>

  <section>
    <h2>Índices por carpeta</h2>
    <div class="grid" id="folders"></div>
  </section>

  <section>
    <h2>Búsqueda</h2>
    <div class="search">
      <input id="q" type="search" placeholder="Buscar por título, categoría o ruta..." autocomplete="off" />
    </div>
    <div class="hint">Usa comillas para frases exactas. Filtra por categoría con: cat:01_Marketing</div>
    <div class="results" id="results"></div>
  </section>

  <footer>
    Generado para documentos_blatam · Carga <code>06_Documentation/search_index.json</code>
  </footer>

<script>
(async function() {
  const foldersEl = document.getElementById('folders');
  const resultsEl = document.getElementById('results');
  const qEl = document.getElementById('q');

  // Top-level known folders to link their INDEX.md if exists
  const topFolders = [
    '01_Marketing','02_Finance','03_Human_Resources','04_Business_Strategy','05_Technology',
    '06_Documentation','07_Advanced_Features','07_Risk_Management','08_AI_Artificial_Intelligence',
    '09_Sales','10_Customer_Service','11_Research_Development','11_System_Architecture',
    '12_Quality_Assurance','12_User_Guides','13_Legal_Compliance','13_Project_Status',
    '14_Procurement','14_Thought_Leadership','15_Logistics','16_Data_Analytics',
    '17_Innovation','18_Sustainability','19_International_Business','20_Project_Management'
  ];

  function linkForFolder(folder) {
    // Prefer INDEX.md in the folder root
    return `${folder}/INDEX.md`;
  }

  foldersEl.innerHTML = topFolders.map(f => `
    <div class="card">
      <div><strong>${f}</strong></div>
      <div class="badges">
        <a class="badge" href="../${linkForFolder(f)}" target="_blank">Abrir índice</a>
        <a class="badge" href="../${f}/" target="_blank">Abrir carpeta</a>
      </div>
    </div>
  `).join('');

  // Load search index
  let idx = [];
  try {
    const res = await fetch('./search_index.json');
    idx = await res.json();
  } catch (e) {
    resultsEl.textContent = 'No se pudo cargar search_index.json';
    return;
  }

  function tokenize(s) {
    return s.toLowerCase().split(/\s+/).filter(Boolean);
  }

  function matches(entry, query) {
    // Support cat:Category filter
    let catFilter = null;
    const tokens = [];
    for (const t of tokenize(query)) {
      if (t.startsWith('cat:')) catFilter = t.slice(4);
      else tokens.push(t);
    }
    if (catFilter && !entry.category.toLowerCase().includes(catFilter)) return false;

    const hay = (entry.title + ' ' + entry.path + ' ' + entry.category).toLowerCase();
    return tokens.every(t => hay.includes(t));
  }

  function render(list) {
    if (!list.length) { resultsEl.textContent = 'Sin resultados'; return; }
    resultsEl.innerHTML = list.slice(0, 200).map(e => `
      <div class="result">
        <a href="../${e.path}" target="_blank">${e.title || e.path}</a>
        <div><small>${e.category} · ${e.path}</small></div>
      </div>
    `).join('');
  }

  function search(q) {
    if (!q || q.trim() === '') { resultsEl.textContent = 'Escribe para buscar (ej: "lead magnet" cat:01_marketing)'; return; }
    const scored = [];
    for (const e of idx) {
      if (matches(e, q)) {
        // simple score by title match weight
        let score = 0;
        const ql = q.toLowerCase();
        if ((e.title||'').toLowerCase().includes(ql)) score += 2;
        if ((e.path||'').toLowerCase().includes(ql)) score += 1;
        scored.push({e, score});
      }
    }
    scored.sort((a,b) => b.score - a.score);
    render(scored.map(s => s.e));
  }

  qEl.addEventListener('input', () => search(qEl.value));
  // Initial hint
  resultsEl.textContent = 'Escribe para buscar (ej: "lead magnet" cat:01_marketing)';
})();
</script>
</body>
</html>
