<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard de MÃ©tricas en Tiempo Real</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0e27;
      color: #e0e0e0;
      padding: 20px;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    .header h1 {
      color: #00d4ff;
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    .header .subtitle {
      color: #888;
      font-size: 0.9em;
    }
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .metric-card {
      background: #1a1f3a;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #2a2f4a;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .metric-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 212, 255, 0.1);
    }
    .metric-label {
      color: #888;
      font-size: 0.85em;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }
    .metric-value {
      color: #00d4ff;
      font-size: 2.5em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .metric-change {
      font-size: 0.85em;
      color: #4caf50;
    }
    .metric-change.negative {
      color: #f44336;
    }
    .chart-container {
      background: #1a1f3a;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid #2a2f4a;
    }
    .chart-title {
      color: #00d4ff;
      margin-bottom: 15px;
      font-size: 1.2em;
    }
    .status-badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: bold;
      margin-left: 10px;
    }
    .status-healthy { background: #4caf50; color: white; }
    .status-warning { background: #ff9800; color: white; }
    .status-critical { background: #f44336; color: white; }
    .refresh-btn {
      background: #00d4ff;
      color: #0a0e27;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      margin: 20px auto;
      display: block;
      transition: background 0.2s;
    }
    .refresh-btn:hover {
      background: #00b8d4;
    }
    .timestamp {
      text-align: center;
      color: #888;
      font-size: 0.85em;
      margin-top: 20px;
    }
    .alerts {
      margin-top: 20px;
    }
    .alert {
      background: #2a2f4a;
      border-left: 4px solid #ff9800;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 4px;
    }
    .alert.critical {
      border-left-color: #f44336;
    }
    .alert.info {
      border-left-color: #00d4ff;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ðŸ“Š Dashboard de MÃ©tricas</h1>
    <div class="subtitle">Monitoreo en tiempo real del sistema de assets</div>
  </div>

  <div class="metrics-grid">
    <div class="metric-card">
      <div class="metric-label">Total Assets SVG</div>
      <div class="metric-value" id="total-svgs">-</div>
      <div class="metric-change" id="svgs-change">Cargando...</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Health Score</div>
      <div class="metric-value" id="health-score">-</div>
      <div class="metric-change" id="health-status">Cargando...</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Tokens Aplicados</div>
      <div class="metric-value" id="tokens-applied">-</div>
      <div class="metric-change" id="tokens-status">Cargando...</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">PNGs Exportados</div>
      <div class="metric-value" id="pngs-exported">-</div>
      <div class="metric-change" id="pngs-change">Cargando...</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Ãšltima ValidaciÃ³n</div>
      <div class="metric-value" id="last-validation" style="font-size: 1.5em;">-</div>
      <div class="metric-change">Ejecutando...</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Problemas Detectados</div>
      <div class="metric-value" id="issues-count">-</div>
      <div class="metric-change" id="issues-status">Cargando...</div>
    </div>
  </div>

  <div class="chart-container">
    <div class="chart-title">ðŸ“ˆ Tendencias de Performance</div>
    <canvas id="performance-chart" width="400" height="150"></canvas>
  </div>

  <div class="alerts" id="alerts-container">
    <!-- Alertas dinÃ¡micas -->
  </div>

  <button class="refresh-btn" onclick="loadMetrics()">ðŸ”„ Actualizar MÃ©tricas</button>
  <div class="timestamp" id="timestamp">-</div>

  <script>
    // SimulaciÃ³n de datos (en producciÃ³n, cargar desde API/archivos)
    let metricsHistory = [];

    async function loadMetrics() {
      document.getElementById('timestamp').textContent = 'Actualizando...';
      
      // Simular carga de mÃ©tricas
      await new Promise(resolve => setTimeout(resolve, 500));
      
      // MÃ©tricas simuladas (en producciÃ³n, usar datos reales)
      const metrics = {
        totalSVGs: Math.floor(Math.random() * 50) + 30,
        healthScore: Math.floor(Math.random() * 20) + 80,
        tokensApplied: 'âœ…',
        pngsExported: Math.floor(Math.random() * 100) + 50,
        lastValidation: new Date().toLocaleTimeString(),
        issuesCount: Math.floor(Math.random() * 5)
      };

      // Actualizar UI
      document.getElementById('total-svgs').textContent = metrics.totalSVGs;
      document.getElementById('health-score').textContent = metrics.healthScore;
      document.getElementById('health-status').textContent = 
        metrics.healthScore >= 90 ? 'âœ… Excelente' : 
        metrics.healthScore >= 70 ? 'âš ï¸ Bueno' : 'âŒ Requiere atenciÃ³n';
      document.getElementById('tokens-applied').textContent = metrics.tokensApplied;
      document.getElementById('tokens-status').textContent = 'Configurados';
      document.getElementById('pngs-exported').textContent = metrics.pngsExported;
      document.getElementById('pngs-change').textContent = '1x y 2x generados';
      document.getElementById('last-validation').textContent = metrics.lastValidation;
      document.getElementById('issues-count').textContent = metrics.issuesCount;
      document.getElementById('issues-status').textContent = 
        metrics.issuesCount === 0 ? 'âœ… Sin problemas' : 'âš ï¸ Revisar';
      document.getElementById('issues-status').className = 
        metrics.issuesCount === 0 ? 'metric-change' : 'metric-change negative';

      // Guardar en historial
      metricsHistory.push({
        time: new Date(),
        score: metrics.healthScore,
        svgs: metrics.totalSVGs
      });

      // Limitar historial a 20 puntos
      if (metricsHistory.length > 20) {
        metricsHistory.shift();
      }

      // Actualizar grÃ¡fico
      updateChart();

      // Generar alertas
      generateAlerts(metrics);

      document.getElementById('timestamp').textContent = 
        `Ãšltima actualizaciÃ³n: ${new Date().toLocaleString()}`;
    }

    function updateChart() {
      const canvas = document.getElementById('performance-chart');
      const ctx = canvas.getContext('2d');
      
      // Ajustar tamaÃ±o del canvas
      canvas.width = canvas.offsetWidth;
      canvas.height = 150;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (metricsHistory.length < 2) return;

      // ConfiguraciÃ³n del grÃ¡fico
      const padding = 40;
      const width = canvas.width - 2 * padding;
      const height = canvas.height - 2 * padding;
      const maxScore = 100;
      const minScore = 0;

      // Ejes
      ctx.strokeStyle = '#2a2f4a';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, canvas.height - padding);
      ctx.lineTo(canvas.width - padding, canvas.height - padding);
      ctx.stroke();

      // LÃ­nea del grÃ¡fico
      ctx.strokeStyle = '#00d4ff';
      ctx.lineWidth = 2;
      ctx.beginPath();

      metricsHistory.forEach((point, index) => {
        const x = padding + (index / (metricsHistory.length - 1)) * width;
        const y = canvas.height - padding - ((point.score - minScore) / (maxScore - minScore)) * height;
        
        if (index === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
      });

      ctx.stroke();

      // Puntos
      ctx.fillStyle = '#00d4ff';
      metricsHistory.forEach((point, index) => {
        const x = padding + (index / (metricsHistory.length - 1)) * width;
        const y = canvas.height - padding - ((point.score - minScore) / (maxScore - minScore)) * height;
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, 2 * Math.PI);
        ctx.fill();
      });
    }

    function generateAlerts(metrics) {
      const container = document.getElementById('alerts-container');
      container.innerHTML = '';

      if (metrics.healthScore < 70) {
        addAlert('critical', 'âš ï¸ Health Score bajo', 
          `El health score estÃ¡ en ${metrics.healthScore}. Ejecutar: bash tools/auto_fix_issues.sh`);
      }

      if (metrics.issuesCount > 3) {
        addAlert('critical', 'ðŸ”´ MÃºltiples problemas detectados', 
          `Se encontraron ${metrics.issuesCount} problemas. Revisar: bash tools/health_check.sh`);
      }

      if (metrics.healthScore >= 90) {
        addAlert('info', 'âœ… Sistema saludable', 
          'Todos los sistemas funcionan correctamente. Continuar monitoreando.');
      }
    }

    function addAlert(type, title, message) {
      const container = document.getElementById('alerts-container');
      const alert = document.createElement('div');
      alert.className = `alert ${type}`;
      alert.innerHTML = `<strong>${title}</strong><br>${message}`;
      container.appendChild(alert);
    }

    // Cargar mÃ©tricas al iniciar
    loadMetrics();

    // Auto-refresh cada 30 segundos
    setInterval(loadMetrics, 30000);
  </script>
</body>
</html>

