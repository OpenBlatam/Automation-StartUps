{
  "nodes": [
    {
      "name": "Sistema Alertas Predictivas V2",
      "type": "n8n-nodes-base.code",
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Sistema de Alertas Predictivas Inteligentes V2\nconst fs = require('fs');\nconst { execSync } = require('child_process');\n\nconst pythonScript = process.env.PYTHON_SCRIPT_PATH || '/Users/adan/IA/scripts/analisis_engagement_avanzado_v2.py';\nconst inputFile = $input.item.json.input_file || '/tmp/engagement_data.json';\nconst umbrales = $input.item.json.umbrales || {\n  engagement_decreciente: -20,\n  engagement_bajo: 100,\n  tasa_viral_baja: 5,\n  roi_decreciente: -15\n};\nconst ventanaDias = $input.item.json.ventana_dias || 7;\n\n// Preparar datos de entrada\nconst inputData = {\n  input_file: inputFile,\n  umbrales: umbrales,\n  ventana_dias: ventanaDias,\n  funcion: 'sistema_alertas_predictivas'\n};\n\nfs.writeFileSync('/tmp/alertas_input.json', JSON.stringify(inputData, null, 2));\n\n// Ejecutar script Python\ntry {\n  const command = `python3 ${pythonScript} /tmp/alertas_input.json --funcion sistema_alertas_predictivas`;\n  const output = execSync(command, { encoding: 'utf-8', maxBuffer: 10 * 1024 * 1024 });\n  \n  // Parsear salida JSON\n  const lines = output.trim().split('\\n');\n  let jsonOutput = null;\n  \n  for (const line of lines) {\n    if (line.trim().startsWith('{') || line.trim().startsWith('[')) {\n      try {\n        jsonOutput = JSON.parse(line);\n        break;\n      } catch (e) {\n        // Continuar buscando\n      }\n    }\n  }\n  \n  if (!jsonOutput) {\n    throw new Error('No se pudo parsear la salida del script Python');\n  }\n  \n  return {\n    json: {\n      alertas: jsonOutput,\n      total_alertas: jsonOutput.total_alertas || 0,\n      alertas_criticas: jsonOutput.alertas_criticas || 0,\n      alertas_alta: jsonOutput.alertas_alta || 0,\n      fecha_analisis: jsonOutput.fecha_analisis || new Date().toISOString(),\n      success: true\n    }\n  };\n} catch (error) {\n  return {\n    json: {\n      success: false,\n      error: error.message,\n      output: error.stdout || error.toString()\n    }\n  };\n}"
      }
    },
    {
      "name": "Análisis ROI Predictivo Avanzado V2",
      "type": "n8n-nodes-base.code",
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Análisis de ROI Predictivo Avanzado con Escenarios\nconst fs = require('fs');\nconst { execSync } = require('child_process');\n\nconst pythonScript = process.env.PYTHON_SCRIPT_PATH || '/Users/adan/IA/scripts/analisis_engagement_avanzado_v2.py';\nconst inputFile = $input.item.json.input_file || '/tmp/engagement_data.json';\nconst mesesProyeccion = $input.item.json.meses_proyeccion || 6;\nconst escenarios = $input.item.json.escenarios || ['conservador', 'realista', 'optimista'];\n\nconst inputData = {\n  input_file: inputFile,\n  meses_proyeccion: mesesProyeccion,\n  escenarios: escenarios,\n  funcion: 'analisis_roi_predictivo_avanzado'\n};\n\nfs.writeFileSync('/tmp/roi_input.json', JSON.stringify(inputData, null, 2));\n\ntry {\n  const command = `python3 ${pythonScript} /tmp/roi_input.json --funcion analisis_roi_predictivo_avanzado`;\n  const output = execSync(command, { encoding: 'utf-8', maxBuffer: 10 * 1024 * 1024 });\n  \n  const lines = output.trim().split('\\n');\n  let jsonOutput = null;\n  \n  for (const line of lines) {\n    if (line.trim().startsWith('{')) {\n      try {\n        jsonOutput = JSON.parse(line);\n        break;\n      } catch (e) {}\n    }\n  }\n  \n  if (!jsonOutput) {\n    throw new Error('No se pudo parsear la salida del script Python');\n  }\n  \n  return {\n    json: {\n      analisis_roi: jsonOutput,\n      proyecciones: jsonOutput.proyecciones || {},\n      escenarios: jsonOutput.escenarios || {},\n      recomendaciones: jsonOutput.recomendaciones || [],\n      success: true\n    }\n  };\n} catch (error) {\n  return {\n    json: {\n      success: false,\n      error: error.message\n    }\n  };\n}"
      }
    },
    {
      "name": "A/B Testing Automatizado V2",
      "type": "n8n-nodes-base.code",
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Sistema de A/B Testing Automatizado\nconst fs = require('fs');\nconst { execSync } = require('child_process');\n\nconst pythonScript = process.env.PYTHON_SCRIPT_PATH || '/Users/adan/IA/scripts/analisis_engagement_avanzado_v2.py';\nconst inputFile = $input.item.json.input_file || '/tmp/engagement_data.json';\nconst grupoA = $input.item.json.grupo_a || [];\nconst grupoB = $input.item.json.grupo_b || [];\nconst nivelSignificancia = $input.item.json.nivel_significancia || 0.05;\n\nconst inputData = {\n  input_file: inputFile,\n  grupo_a: grupoA,\n  grupo_b: grupoB,\n  nivel_significancia: nivelSignificancia,\n  funcion: 'ab_testing_automatizado'\n};\n\nfs.writeFileSync('/tmp/ab_test_input.json', JSON.stringify(inputData, null, 2));\n\ntry {\n  const command = `python3 ${pythonScript} /tmp/ab_test_input.json --funcion ab_testing_automatizado`;\n  const output = execSync(command, { encoding: 'utf-8', maxBuffer: 10 * 1024 * 1024 });\n  \n  const lines = output.trim().split('\\n');\n  let jsonOutput = null;\n  \n  for (const line of lines) {\n    if (line.trim().startsWith('{')) {\n      try {\n        jsonOutput = JSON.parse(line);\n        break;\n      } catch (e) {}\n    }\n  }\n  \n  if (!jsonOutput) {\n    throw new Error('No se pudo parsear la salida del script Python');\n  }\n  \n  return {\n    json: {\n      ab_test: jsonOutput,\n      ganador: jsonOutput.ganador || null,\n      significancia: jsonOutput.significancia || false,\n      diferencia_porcentual: jsonOutput.diferencia_porcentual || 0,\n      recomendacion: jsonOutput.recomendacion || '',\n      success: true\n    }\n  };\n} catch (error) {\n  return {\n    json: {\n      success: false,\n      error: error.message\n    }\n  };\n}"
      }
    },
    {
      "name": "Análisis Sentimiento Avanzado V2",
      "type": "n8n-nodes-base.code",
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Análisis de Sentimiento Avanzado con NLP\nconst fs = require('fs');\nconst { execSync } = require('child_process');\n\nconst pythonScript = process.env.PYTHON_SCRIPT_PATH || '/Users/adan/IA/scripts/analisis_engagement_avanzado_v2.py';\nconst inputFile = $input.item.json.input_file || '/tmp/engagement_data.json';\nconst comentarios = $input.item.json.comentarios || [];\nconst aspectos = $input.item.json.aspectos || ['calidad', 'precio', 'servicio'];\n\nconst inputData = {\n  input_file: inputFile,\n  comentarios: comentarios,\n  aspectos: aspectos,\n  funcion: 'analisis_sentimiento_avanzado'\n};\n\nfs.writeFileSync('/tmp/sentimiento_input.json', JSON.stringify(inputData, null, 2));\n\ntry {\n  const command = `python3 ${pythonScript} /tmp/sentimiento_input.json --funcion analisis_sentimiento_avanzado`;\n  const output = execSync(command, { encoding: 'utf-8', maxBuffer: 10 * 1024 * 1024 });\n  \n  const lines = output.trim().split('\\n');\n  let jsonOutput = null;\n  \n  for (const line of lines) {\n    if (line.trim().startsWith('{')) {\n      try {\n        jsonOutput = JSON.parse(line);\n        break;\n      } catch (e) {}\n    }\n  }\n  \n  if (!jsonOutput) {\n    throw new Error('No se pudo parsear la salida del script Python');\n  }\n  \n  return {\n    json: {\n      sentimiento: jsonOutput,\n      sentimiento_general: jsonOutput.sentimiento_general || 'neutral',\n      score_sentimiento: jsonOutput.score_sentimiento || 0,\n      analisis_aspectos: jsonOutput.analisis_aspectos || {},\n      temas_principales: jsonOutput.temas_principales || [],\n      recomendaciones: jsonOutput.recomendaciones || [],\n      success: true\n    }\n  };\n} catch (error) {\n  return {\n    json: {\n      success: false,\n      error: error.message\n    }\n  };\n}"
      }
    },
    {
      "name": "Detección Oportunidades Contenido V2",
      "type": "n8n-nodes-base.code",
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Detección Automática de Oportunidades de Contenido\nconst fs = require('fs');\nconst { execSync } = require('child_process');\n\nconst pythonScript = process.env.PYTHON_SCRIPT_PATH || '/Users/adan/IA/scripts/analisis_engagement_avanzado_v2.py';\nconst inputFile = $input.item.json.input_file || '/tmp/engagement_data.json';\nconst minScore = $input.item.json.min_score || 70;\nconst categorias = $input.item.json.categorias || [];\n\nconst inputData = {\n  input_file: inputFile,\n  min_score: minScore,\n  categorias: categorias,\n  funcion: 'deteccion_oportunidades_contenido'\n};\n\nfs.writeFileSync('/tmp/oportunidades_input.json', JSON.stringify(inputData, null, 2));\n\ntry {\n  const command = `python3 ${pythonScript} /tmp/oportunidades_input.json --funcion deteccion_oportunidades_contenido`;\n  const output = execSync(command, { encoding: 'utf-8', maxBuffer: 10 * 1024 * 1024 });\n  \n  const lines = output.trim().split('\\n');\n  let jsonOutput = null;\n  \n  for (const line of lines) {\n    if (line.trim().startsWith('{')) {\n      try {\n        jsonOutput = JSON.parse(line);\n        break;\n      } catch (e) {}\n    }\n  }\n  \n  if (!jsonOutput) {\n    throw new Error('No se pudo parsear la salida del script Python');\n  }\n  \n  return {\n    json: {\n      oportunidades: jsonOutput,\n      total_oportunidades: jsonOutput.total_oportunidades || 0,\n      oportunidades_prioritarias: jsonOutput.oportunidades_prioritarias || [],\n      ideas_contenido: jsonOutput.ideas_contenido || [],\n      potencial_viral: jsonOutput.potencial_viral || 0,\n      success: true\n    }\n  };\n} catch (error) {\n  return {\n    json: {\n      success: false,\n      error: error.message\n    }\n  };\n}"
      }
    },
    {
      "name": "Análisis Cross-Platform Avanzado V2",
      "type": "n8n-nodes-base.code",
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Análisis Cross-Platform Avanzado\nconst fs = require('fs');\nconst { execSync } = require('child_process');\n\nconst pythonScript = process.env.PYTHON_SCRIPT_PATH || '/Users/adan/IA/scripts/analisis_engagement_avanzado_v2.py';\nconst inputFile = $input.item.json.input_file || '/tmp/engagement_data.json';\nconst plataformas = $input.item.json.plataformas || ['instagram', 'tiktok', 'youtube'];\n\nconst inputData = {\n  input_file: inputFile,\n  plataformas: plataformas,\n  funcion: 'analisis_cross_platform_avanzado'\n};\n\nfs.writeFileSync('/tmp/cross_platform_input.json', JSON.stringify(inputData, null, 2));\n\ntry {\n  const command = `python3 ${pythonScript} /tmp/cross_platform_input.json --funcion analisis_cross_platform_avanzado`;\n  const output = execSync(command, { encoding: 'utf-8', maxBuffer: 10 * 1024 * 1024 });\n  \n  const lines = output.trim().split('\\n');\n  let jsonOutput = null;\n  \n  for (const line of lines) {\n    if (line.trim().startsWith('{')) {\n      try {\n        jsonOutput = JSON.parse(line);\n        break;\n      } catch (e) {}\n    }\n  }\n  \n  if (!jsonOutput) {\n    throw new Error('No se pudo parsear la salida del script Python');\n  }\n  \n  return {\n    json: {\n      analisis_cross_platform: jsonOutput,\n      comparacion_plataformas: jsonOutput.comparacion_plataformas || {},\n      estrategia_recomendada: jsonOutput.estrategia_recomendada || {},\n      oportunidades_cross_platform: jsonOutput.oportunidades_cross_platform || [],\n      sinergias: jsonOutput.sinergias || [],\n      success: true\n    }\n  };\n} catch (error) {\n  return {\n    json: {\n      success: false,\n      error: error.message\n    }\n  };\n}"
      }
    },
    {
      "name": "Scoring Contenido Tiempo Real V2",
      "type": "n8n-nodes-base.code",
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Sistema de Scoring de Contenido en Tiempo Real\nconst fs = require('fs');\nconst { execSync } = require('child_process');\n\nconst pythonScript = process.env.PYTHON_SCRIPT_PATH || '/Users/adan/IA/scripts/analisis_engagement_avanzado_v2.py';\nconst contenido = $input.item.json.contenido || {};\nconst plataforma = $input.item.json.plataforma || 'instagram';\nconst objetivo = $input.item.json.objetivo || 'engagement';\n\nconst inputData = {\n  contenido: contenido,\n  plataforma: plataforma,\n  objetivo: objetivo,\n  funcion: 'scoring_contenido_tiempo_real'\n};\n\nfs.writeFileSync('/tmp/scoring_input.json', JSON.stringify(inputData, null, 2));\n\ntry {\n  const command = `python3 ${pythonScript} /tmp/scoring_input.json --funcion scoring_contenido_tiempo_real`;\n  const output = execSync(command, { encoding: 'utf-8', maxBuffer: 10 * 1024 * 1024 });\n  \n  const lines = output.trim().split('\\n');\n  let jsonOutput = null;\n  \n  for (const line of lines) {\n    if (line.trim().startsWith('{')) {\n      try {\n        jsonOutput = JSON.parse(line);\n        break;\n      } catch (e) {}\n    }\n  }\n  \n  if (!jsonOutput) {\n    throw new Error('No se pudo parsear la salida del script Python');\n  }\n  \n  return {\n    json: {\n      scoring: jsonOutput,\n      score_total: jsonOutput.score_total || 0,\n      score_engagement: jsonOutput.score_engagement || 0,\n      score_viral: jsonOutput.score_viral || 0,\n      score_roi: jsonOutput.score_roi || 0,\n      factores_clave: jsonOutput.factores_clave || [],\n      recomendaciones_mejora: jsonOutput.recomendaciones_mejora || [],\n      prediccion_engagement: jsonOutput.prediccion_engagement || 0,\n      success: true\n    }\n  };\n} catch (error) {\n  return {\n    json: {\n      success: false,\n      error: error.message\n    }\n  };\n}"
      }
    },
    {
      "name": "Análisis Tendencias Mercado V2",
      "type": "n8n-nodes-base.code",
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Análisis de Tendencias de Mercado\nconst fs = require('fs');\nconst { execSync } = require('child_process');\n\nconst pythonScript = process.env.PYTHON_SCRIPT_PATH || '/Users/adan/IA/scripts/analisis_engagement_avanzado_v2.py';\nconst inputFile = $input.item.json.input_file || '/tmp/engagement_data.json';\nconst ventanaDias = $input.item.json.ventana_dias || 30;\nconst minFrecuencia = $input.item.json.min_frecuencia || 3;\n\nconst inputData = {\n  input_file: inputFile,\n  ventana_dias: ventanaDias,\n  min_frecuencia: minFrecuencia,\n  funcion: 'analisis_tendencias_mercado'\n};\n\nfs.writeFileSync('/tmp/tendencias_input.json', JSON.stringify(inputData, null, 2));\n\ntry {\n  const command = `python3 ${pythonScript} /tmp/tendencias_input.json --funcion analisis_tendencias_mercado`;\n  const output = execSync(command, { encoding: 'utf-8', maxBuffer: 10 * 1024 * 1024 });\n  \n  const lines = output.trim().split('\\n');\n  let jsonOutput = null;\n  \n  for (const line of lines) {\n    if (line.trim().startsWith('{')) {\n      try {\n        jsonOutput = JSON.parse(line);\n        break;\n      } catch (e) {}\n    }\n  }\n  \n  if (!jsonOutput) {\n    throw new Error('No se pudo parsear la salida del script Python');\n  }\n  \n  return {\n    json: {\n      tendencias: jsonOutput,\n      tendencias_emergentes: jsonOutput.tendencias_emergentes || [],\n      tendencias_decrecientes: jsonOutput.tendencias_decrecientes || [],\n      oportunidades_tendencias: jsonOutput.oportunidades_tendencias || [],\n      prediccion_tendencias: jsonOutput.prediccion_tendencias || {},\n      recomendaciones_estrategia: jsonOutput.recomendaciones_estrategia || [],\n      success: true\n    }\n  };\n} catch (error) {\n  return {\n    json: {\n      success: false,\n      error: error.message\n    }\n  };\n}"
      }
    }
  ]
}

