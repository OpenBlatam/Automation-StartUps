version: '3.8'

services:
  chatbot-api:
    build:
      context: .
      dockerfile: scripts/Dockerfile.chatbot
    container_name: chatbot-api
    ports:
      - "5000:5000"
    environment:
      - CHATBOT_ENABLE_LOGGING=true
      - CHATBOT_PERSIST_CONVERSATIONS=true
      - CHATBOT_ENABLE_RATE_LIMITING=true
      - CHATBOT_ENABLE_FEEDBACK=true
      - PORT=5000
      - DEBUG=false
    volumes:
      - ./chatbot_conversations:/app/chatbot_conversations
      - ./logs:/app/logs
      - ./exports:/app/exports
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python3", "-c", "from chatbot_curso_ia_webinars import CursoIAWebinarChatbot; chatbot = CursoIAWebinarChatbot(enable_logging=False); exit(0 if chatbot.health_check()['status'] == 'healthy' else 1)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  chatbot-worker:
    build:
      context: .
      dockerfile: scripts/Dockerfile.chatbot
    container_name: chatbot-worker
    command: python3 chatbot_curso_ia_webinars.py
    environment:
      - CHATBOT_ENABLE_LOGGING=true
      - CHATBOT_PERSIST_CONVERSATIONS=true
    volumes:
      - ./chatbot_conversations:/app/chatbot_conversations
      - ./logs:/app/logs
    restart: unless-stopped
    depends_on:
      - chatbot-api






