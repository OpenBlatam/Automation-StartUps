# ü§ñ FINANCIAL AUTOMATION SCRIPTS & MACROS
## Excel VBA Macros and Automation Tools for Financial Management

**Version:** 1.0  
**Date:** 2025-01-27  
**Purpose:** Automate routine financial tasks and improve efficiency

---

## üìä EXCEL VBA MACROS

### 1. Monthly Financial Report Generator
```vba
Sub GenerateMonthlyReport()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim reportDate As Date
    
    ' Set report date
    reportDate = DateSerial(Year(Date), Month(Date), 1)
    
    ' Create new worksheet for report
    Set ws = Worksheets.Add
    ws.Name = "Monthly_Report_" & Format(reportDate, "YYYY_MM")
    
    ' Add headers
    ws.Cells(1, 1).Value = "MONTHLY FINANCIAL REPORT"
    ws.Cells(1, 2).Value = Format(reportDate, "MMMM YYYY")
    ws.Cells(3, 1).Value = "Revenue"
    ws.Cells(4, 1).Value = "Expenses"
    ws.Cells(5, 1).Value = "Net Income"
    ws.Cells(6, 1).Value = "Cash Flow"
    
    ' Pull data from source sheets
    ws.Cells(3, 2).Formula = "=SUM(Revenue_Data!B:B)"
    ws.Cells(4, 2).Formula = "=SUM(Expense_Data!B:B)"
    ws.Cells(5, 2).Formula = "=B3-B4"
    ws.Cells(6, 2).Formula = "=SUM(Cash_Flow!B:B)"
    
    ' Format the report
    ws.Range("A1:B6").Font.Bold = True
    ws.Range("B3:B6").NumberFormat = "$#,##0"
    ws.Columns("A:B").AutoFit
    
    MsgBox "Monthly report generated successfully!"
End Sub
```

### 2. Budget Variance Analyzer
```vba
Sub AnalyzeBudgetVariance()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim i As Long
    
    Set ws = ActiveSheet
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Add variance columns if they don't exist
    If ws.Cells(1, 4).Value = "" Then
        ws.Cells(1, 4).Value = "Variance"
        ws.Cells(1, 5).Value = "Variance %"
        ws.Cells(1, 6).Value = "Status"
    End If
    
    ' Calculate variances for each row
    For i = 2 To lastRow
        If ws.Cells(i, 2).Value <> "" And ws.Cells(i, 3).Value <> "" Then
            ' Calculate variance
            ws.Cells(i, 4).Value = ws.Cells(i, 3).Value - ws.Cells(i, 2).Value
            
            ' Calculate variance percentage
            If ws.Cells(i, 2).Value <> 0 Then
                ws.Cells(i, 5).Value = ws.Cells(i, 4).Value / ws.Cells(i, 2).Value
            End If
            
            ' Set status based on variance
            If Abs(ws.Cells(i, 5).Value) > 0.1 Then
                ws.Cells(i, 6).Value = "Review Required"
                ws.Cells(i, 6).Interior.Color = RGB(255, 255, 0) ' Yellow
            ElseIf ws.Cells(i, 5).Value > 0 Then
                ws.Cells(i, 6).Value = "Under Budget"
                ws.Cells(i, 6).Interior.Color = RGB(0, 255, 0) ' Green
            Else
                ws.Cells(i, 6).Value = "Over Budget"
                ws.Cells(i, 6).Interior.Color = RGB(255, 0, 0) ' Red
            End If
        End If
    Next i
    
    ' Format variance columns
    ws.Range("D:D").NumberFormat = "$#,##0"
    ws.Range("E:E").NumberFormat = "0.00%"
    
    MsgBox "Budget variance analysis completed!"
End Sub
```

### 3. Financial Ratio Calculator
```vba
Sub CalculateFinancialRatios()
    Dim ws As Worksheet
    Dim ratioSheet As Worksheet
    
    Set ws = ActiveSheet
    
    ' Create ratios worksheet
    On Error Resume Next
    Set ratioSheet = Worksheets("Financial_Ratios")
    On Error GoTo 0
    
    If ratioSheet Is Nothing Then
        Set ratioSheet = Worksheets.Add
        ratioSheet.Name = "Financial_Ratios"
    End If
    
    ' Clear existing data
    ratioSheet.Cells.Clear
    
    ' Add headers
    ratioSheet.Cells(1, 1).Value = "FINANCIAL RATIOS"
    ratioSheet.Cells(1, 1).Font.Bold = True
    ratioSheet.Cells(1, 1).Font.Size = 14
    
    ' Add ratio categories
    ratioSheet.Cells(3, 1).Value = "LIQUIDITY RATIOS"
    ratioSheet.Cells(3, 1).Font.Bold = True
    
    ratioSheet.Cells(4, 1).Value = "Current Ratio"
    ratioSheet.Cells(4, 2).Formula = "=Balance_Sheet!B2/Balance_Sheet!B5"
    
    ratioSheet.Cells(5, 1).Value = "Quick Ratio"
    ratioSheet.Cells(5, 2).Formula = "=(Balance_Sheet!B2-Balance_Sheet!B3)/Balance_Sheet!B5"
    
    ratioSheet.Cells(7, 1).Value = "PROFITABILITY RATIOS"
    ratioSheet.Cells(7, 1).Font.Bold = True
    
    ratioSheet.Cells(8, 1).Value = "Gross Margin"
    ratioSheet.Cells(8, 2).Formula = "=(Income_Statement!B1-Income_Statement!B2)/Income_Statement!B1"
    
    ratioSheet.Cells(9, 1).Value = "Net Margin"
    ratioSheet.Cells(9, 2).Formula = "=Income_Statement!B4/Income_Statement!B1"
    
    ratioSheet.Cells(10, 1).Value = "ROE"
    ratioSheet.Cells(10, 2).Formula = "=Income_Statement!B4/Balance_Sheet!B6"
    
    ' Format ratios
    ratioSheet.Range("B4:B10").NumberFormat = "0.00"
    ratioSheet.Columns("A:B").AutoFit
    
    MsgBox "Financial ratios calculated successfully!"
End Sub
```

### 4. Cash Flow Forecast Generator
```vba
Sub GenerateCashFlowForecast()
    Dim ws As Worksheet
    Dim i As Integer
    Dim startDate As Date
    Dim currentDate As Date
    
    ' Create new worksheet
    Set ws = Worksheets.Add
    ws.Name = "Cash_Flow_Forecast"
    
    ' Set start date (beginning of next month)
    startDate = DateSerial(Year(Date), Month(Date) + 1, 1)
    
    ' Add headers
    ws.Cells(1, 1).Value = "CASH FLOW FORECAST"
    ws.Cells(1, 1).Font.Bold = True
    ws.Cells(1, 1).Font.Size = 14
    
    ws.Cells(3, 1).Value = "Month"
    ws.Cells(3, 2).Value = "Opening Cash"
    ws.Cells(3, 3).Value = "Cash Inflows"
    ws.Cells(3, 4).Value = "Cash Outflows"
    ws.Cells(3, 5).Value = "Net Cash Flow"
    ws.Cells(3, 6).Value = "Closing Cash"
    
    ' Format headers
    ws.Range("A3:F3").Font.Bold = True
    ws.Range("A3:F3").Interior.Color = RGB(200, 200, 200)
    
    ' Generate 12 months of forecast
    For i = 1 To 12
        currentDate = DateAdd("m", i - 1, startDate)
        
        ws.Cells(3 + i, 1).Value = Format(currentDate, "MMM YYYY")
        
        ' Opening cash (previous month's closing cash)
        If i = 1 Then
            ws.Cells(3 + i, 2).Value = 0 ' Starting cash balance
        Else
            ws.Cells(3 + i, 2).Formula = "=F" & (3 + i - 1)
        End If
        
        ' Cash inflows (formula based on historical data)
        ws.Cells(3 + i, 3).Formula = "=AVERAGE(Historical_Data!C:C)*1.05" ' 5% growth
        
        ' Cash outflows (formula based on historical data)
        ws.Cells(3 + i, 4).Formula = "=AVERAGE(Historical_Data!D:D)*1.03" ' 3% growth
        
        ' Net cash flow
        ws.Cells(3 + i, 5).Formula = "=C" & (3 + i) & "-D" & (3 + i)
        
        ' Closing cash
        ws.Cells(3 + i, 6).Formula = "=B" & (3 + i) & "+E" & (3 + i)
    Next i
    
    ' Format currency columns
    ws.Range("B4:F15").NumberFormat = "$#,##0"
    ws.Columns("A:F").AutoFit
    
    MsgBox "Cash flow forecast generated for 12 months!"
End Sub
```

### 5. Automated Dashboard Updater
```vba
Sub UpdateDashboard()
    Dim ws As Worksheet
    Dim lastUpdate As String
    
    Set ws = Worksheets("Dashboard")
    
    ' Update last refresh time
    lastUpdate = Format(Now, "MM/DD/YYYY HH:MM:SS")
    ws.Cells(1, 1).Value = "Last Updated: " & lastUpdate
    
    ' Refresh all data connections
    Application.CalculateFullRebuild
    
    ' Update key metrics
    ws.Cells(5, 2).Formula = "=SUM(Revenue_Data!B:B)"
    ws.Cells(6, 2).Formula = "=SUM(Expense_Data!B:B)"
    ws.Cells(7, 2).Formula = "=B5-B6"
    ws.Cells(8, 2).Formula = "=SUM(Cash_Flow!B:B)"
    
    ' Update charts
    Dim cht As ChartObject
    For Each cht In ws.ChartObjects
        cht.Chart.Refresh
    Next cht
    
    ' Add conditional formatting
    If ws.Cells(7, 2).Value < 0 Then
        ws.Cells(7, 2).Interior.Color = RGB(255, 200, 200) ' Light red
    Else
        ws.Cells(7, 2).Interior.Color = RGB(200, 255, 200) ' Light green
    End If
    
    MsgBox "Dashboard updated successfully at " & lastUpdate
End Sub
```

---

## üîÑ AUTOMATION WORKFLOWS

### 6. Monthly Close Automation
```vba
Sub MonthlyCloseProcess()
    Dim ws As Worksheet
    Dim closeDate As Date
    
    closeDate = DateSerial(Year(Date), Month(Date), 1)
    
    ' Step 1: Reconcile all accounts
    Call ReconcileAccounts
    
    ' Step 2: Generate financial statements
    Call GenerateFinancialStatements
    
    ' Step 3: Calculate ratios
    Call CalculateFinancialRatios
    
    ' Step 4: Create variance analysis
    Call AnalyzeBudgetVariance
    
    ' Step 5: Generate management report
    Call GenerateMonthlyReport
    
    ' Step 6: Update dashboard
    Call UpdateDashboard
    
    ' Step 7: Send notifications
    Call SendCloseNotifications
    
    MsgBox "Monthly close process completed successfully!"
End Sub

Sub ReconcileAccounts()
    ' Reconcile bank accounts
    ' Reconcile credit card accounts
    ' Reconcile intercompany accounts
    MsgBox "Account reconciliation completed"
End Sub

Sub GenerateFinancialStatements()
    ' Generate P&L
    ' Generate Balance Sheet
    ' Generate Cash Flow Statement
    MsgBox "Financial statements generated"
End Sub

Sub SendCloseNotifications()
    ' Send email notifications to management
    ' Update status in project management system
    MsgBox "Notifications sent"
End Sub
```

### 7. Budget Approval Workflow
```vba
Sub BudgetApprovalWorkflow()
    Dim ws As Worksheet
    Dim approver As String
    Dim status As String
    
    Set ws = ActiveSheet
    
    ' Check if budget is ready for approval
    If ws.Cells(2, 5).Value = "Ready for Review" Then
        
        ' Get approver information
        approver = InputBox("Enter approver name:")
        
        If approver <> "" Then
            ' Update approval status
            ws.Cells(2, 6).Value = "Under Review"
            ws.Cells(2, 7).Value = approver
            ws.Cells(2, 8).Value = Date
            
            ' Send approval request
            Call SendApprovalRequest(approver)
            
            MsgBox "Budget sent to " & approver & " for approval"
        End If
    Else
        MsgBox "Budget is not ready for approval"
    End If
End Sub

Sub SendApprovalRequest(approver As String)
    ' Create email notification
    ' Include budget details
    ' Set up approval tracking
    MsgBox "Approval request sent to " & approver
End Sub
```

---

## üìß EMAIL AUTOMATION

### 8. Automated Report Distribution
```vba
Sub SendMonthlyReports()
    Dim OutApp As Object
    Dim OutMail As Object
    Dim ws As Worksheet
    Dim recipients As String
    Dim reportPath As String
    
    ' Create Outlook application
    Set OutApp = CreateObject("Outlook.Application")
    Set OutMail = OutApp.CreateItem(0)
    
    ' Set recipients
    recipients = "finance@company.com;management@company.com"
    
    ' Set report path
    reportPath = ThisWorkbook.Path & "\Monthly_Report_" & Format(Date, "YYYY_MM") & ".pdf"
    
    ' Create email
    With OutMail
        .To = recipients
        .Subject = "Monthly Financial Report - " & Format(Date, "MMMM YYYY")
        .Body = "Please find attached the monthly financial report for " & Format(Date, "MMMM YYYY") & vbCrLf & vbCrLf & _
                "Key highlights:" & vbCrLf & _
                "- Revenue: " & Format(Worksheets("Dashboard").Cells(5, 2).Value, "$#,##0") & vbCrLf & _
                "- Expenses: " & Format(Worksheets("Dashboard").Cells(6, 2).Value, "$#,##0") & vbCrLf & _
                "- Net Income: " & Format(Worksheets("Dashboard").Cells(7, 2).Value, "$#,##0") & vbCrLf & vbCrLf & _
                "Please review and let me know if you have any questions." & vbCrLf & vbCrLf & _
                "Best regards," & vbCrLf & _
                "Finance Team"
        
        ' Attach report if it exists
        If Dir(reportPath) <> "" Then
            .Attachments.Add reportPath
        End If
        
        .Send
    End With
    
    Set OutMail = Nothing
    Set OutApp = Nothing
    
    MsgBox "Monthly reports sent successfully!"
End Sub
```

---

## üîç DATA VALIDATION & QUALITY

### 9. Data Quality Checker
```vba
Sub DataQualityCheck()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim i As Long
    Dim errorCount As Integer
    
    Set ws = ActiveSheet
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    errorCount = 0
    
    ' Check for missing data
    For i = 2 To lastRow
        If ws.Cells(i, 1).Value = "" Then
            ws.Cells(i, 1).Interior.Color = RGB(255, 200, 200)
            errorCount = errorCount + 1
        End If
        
        If ws.Cells(i, 2).Value = "" Then
            ws.Cells(i, 2).Interior.Color = RGB(255, 200, 200)
            errorCount = errorCount + 1
        End If
        
        ' Check for negative values where not expected
        If ws.Cells(i, 2).Value < 0 And ws.Cells(i, 1).Value Like "*Revenue*" Then
            ws.Cells(i, 2).Interior.Color = RGB(255, 255, 0)
            errorCount = errorCount + 1
        End If
    Next i
    
    ' Check for duplicate entries
    Call CheckDuplicates
    
    MsgBox "Data quality check completed. Found " & errorCount & " potential issues."
End Sub

Sub CheckDuplicates()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim i As Long, j As Long
    
    Set ws = ActiveSheet
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    For i = 2 To lastRow
        For j = i + 1 To lastRow
            If ws.Cells(i, 1).Value = ws.Cells(j, 1).Value Then
                ws.Cells(i, 1).Interior.Color = RGB(255, 200, 200)
                ws.Cells(j, 1).Interior.Color = RGB(255, 200, 200)
            End If
        Next j
    Next i
End Sub
```

---

## üìä CHART & VISUALIZATION AUTOMATION

### 10. Dynamic Chart Generator
```vba
Sub CreateDynamicCharts()
    Dim ws As Worksheet
    Dim cht As ChartObject
    Dim chartRange As Range
    
    Set ws = ActiveSheet
    
    ' Create revenue trend chart
    Set chartRange = ws.Range("A1:B13") ' Adjust range as needed
    Set cht = ws.ChartObjects.Add(Left:=400, Top:=50, Width:=400, Height:=300)
    
    With cht.Chart
        .SetSourceData chartRange
        .ChartType = xlLine
        .HasTitle = True
        .ChartTitle.Text = "Revenue Trend"
        .Axes(xlCategory).HasTitle = True
        .Axes(xlCategory).AxisTitle.Text = "Month"
        .Axes(xlValue).HasTitle = True
        .Axes(xlValue).AxisTitle.Text = "Revenue ($)"
    End With
    
    ' Create expense breakdown pie chart
    Set chartRange = ws.Range("D1:E6") ' Adjust range as needed
    Set cht = ws.ChartObjects.Add(Left:=50, Top:=400, Width:=300, Height:=300)
    
    With cht.Chart
        .SetSourceData chartRange
        .ChartType = xlPie
        .HasTitle = True
        .ChartTitle.Text = "Expense Breakdown"
    End With
    
    MsgBox "Dynamic charts created successfully!"
End Sub
```

---

## üö® ALERT & NOTIFICATION SYSTEM

### 11. Financial Alert System
```vba
Sub CheckFinancialAlerts()
    Dim ws As Worksheet
    Dim alertCount As Integer
    
    Set ws = Worksheets("Dashboard")
    alertCount = 0
    
    ' Check cash flow alert
    If ws.Cells(8, 2).Value < 50000 Then
        Call SendAlert("Low Cash Flow", "Cash balance is below $50,000")
        alertCount = alertCount + 1
    End If
    
    ' Check budget variance alert
    If ws.Cells(10, 2).Value > 0.1 Then
        Call SendAlert("Budget Variance", "Budget variance exceeds 10%")
        alertCount = alertCount + 1
    End If
    
    ' Check overdue receivables
    If ws.Cells(12, 2).Value > 30 Then
        Call SendAlert("Overdue Receivables", "Average days in A/R exceeds 30 days")
        alertCount = alertCount + 1
    End If
    
    If alertCount = 0 Then
        MsgBox "No financial alerts at this time"
    Else
        MsgBox alertCount & " financial alerts detected and sent"
    End If
End Sub

Sub SendAlert(alertType As String, message As String)
    ' Create alert notification
    ' Send to appropriate stakeholders
    ' Log alert in system
    MsgBox "ALERT: " & alertType & " - " & message
End Sub
```

---

## üìã USAGE INSTRUCTIONS

### How to Use These Macros:

1. **Enable Macros:**
   - Go to File > Options > Trust Center > Trust Center Settings
   - Enable "Enable all macros"

2. **Add Macros to Your Workbook:**
   - Press Alt + F11 to open VBA editor
   - Insert > Module
   - Copy and paste the macro code
   - Save the workbook as .xlsm format

3. **Create Buttons for Easy Access:**
   - Developer tab > Insert > Button
   - Assign macro to button
   - Customize button text and appearance

4. **Schedule Automatic Execution:**
   - Use Windows Task Scheduler
   - Set up recurring tasks
   - Configure to run macros at specific times

### Security Considerations:
- Always backup your data before running macros
- Test macros on sample data first
- Review macro code before execution
- Keep macros in trusted locations

---

**Note:** These macros are provided as templates and should be customized based on your specific data structure and requirements. Always test thoroughly before implementing in production environments.

