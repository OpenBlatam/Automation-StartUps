# ๐ Diagramas de Arquitectura

> **Versiรณn**: 1.0 | **รltima actualizaciรณn**: 2024

Diagramas visuales de la arquitectura del sistema.

## ๐ Tabla de Contenidos

- [Arquitectura de Alto Nivel](#-arquitectura-de-alto-nivel)
- [Flujo de Datos](#-flujo-de-datos)
- [Arquitectura de Aprobaciones](#-arquitectura-de-aprobaciones)
- [Flujo de ETL](#-flujo-de-etl)
- [Arquitectura de Kubernetes](#-arquitectura-de-kubernetes)

---

## ๐๏ธ Arquitectura de Alto Nivel

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      CAPA DE PRESENTACIรN                        โ
โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ
โ  โ Grafana  โ  โ  Kestra  โ  โ Airflow  โ  โ   Web    โ      โ
โ  โ Dashboardโ  โ   UI     โ  โ   UI     โ  โ  Apps    โ      โ
โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      CAPA DE ORQUESTACIรN                        โ
โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ
โ  โ Kestra   โ  โ Flowable โ  โ Camunda  โ  โ Airflow  โ      โ
โ  โ Workflowsโ  โ   BPM    โ  โ   BPM    โ  โ   DAGs   โ      โ
โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      CAPA DE SERVICIOS                           โ
โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ
โ  โ  ETL     โ  โ   ML     โ  โ   RPA    โ  โ  APIs    โ      โ
โ  โ Services โ  โ Services โ  โ Services โ  โ Gateway  โ      โ
โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      CAPA DE DATOS                               โ
โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ
โ  โPostgreSQLโ  โ  Kafka   โ  โ   S3/    โ  โ  Redis   โ      โ
โ  โ          โ  โ          โ  โ  ADLS    โ  โ  Cache   โ      โ
โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      CAPA DE INFRAESTRUCTURA                     โ
โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ
โ  โ Kubernetesโ โ  Prometheusโ โ  Loki    โ  โ  Vault   โ      โ
โ  โ   (EKS/   โ โ  /Grafana  โ โ  Logs    โ  โ Secrets  โ      โ
โ  โ   AKS)    โ โ            โ โ          โ  โ          โ      โ
โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Flujo de Datos

### Flujo Tรญpico de Procesamiento

```
โโโโโโโโโโโโโโโ
โ   Trigger   โ (Evento o Programado)
โ  (Cron/API) โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ Orquestador โ (Kestra/Flowable/Airflow)
โ  Workflow   โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ  Extracciรณn โ
โ    de Datos โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โTransformaciรณnโ
โ y Validaciรณnโ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ  Carga a    โ
โ Data Lake/DBโ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ Anรกlisis y  โ
โ  Reportes   โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โNotificacionesโ
โ  y Alertas  โ
โโโโโโโโโโโโโโโ
```

### Flujo de Aprobaciones

```
โโโโโโโโโโโโโโโโโโโ
โ Solicitud de    โ
โ  Aprobaciรณn     โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ Validaciรณn de   โ
โ Reglas de       โ
โ   Negocio       โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  Asignaciรณn a   โ
โ   Aprobadores   โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ Notificaciones  โ
โ (Email/Slack)   โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  Proceso de     โ
โ  Aprobaciรณn     โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
    โโโโโโดโโโโโ
    โ         โ
    โผ         โผ
โโโโโโโโโโ โโโโโโโโโโโโโโ
โAprobadoโ โ Rechazado  โ
โโโโโฌโโโโโ โโโโโโโฌโโโโโโโ
    โ            โ
    โผ            โผ
โโโโโโโโโโ โโโโโโโโโโโโโโ
โEjecuciรณnโ โNotificaciรณnโ
โ        โ โ y Archivadoโ
โโโโโโโโโโ โโโโโโโโโโโโโโ
```

---

## โ Arquitectura de Aprobaciones

### Arquitectura Modular

```
approval_cleanup.py (DAG Principal)
    โ
    โโโ approval_cleanup_config.py
    โ   โโโ Configuraciรณn centralizada
    โ       โโโ Variables de entorno
    โ       โโโ Constantes
    โ       โโโ get_config()
    โ
    โโโ approval_cleanup_ops.py
    โ   โโโ Operaciones de BD
    โ       โโโ get_pg_hook()
    โ       โโโ execute_query_with_timeout()
    โ       โโโ process_batch()
    โ
    โโโ approval_cleanup_queries.py
    โ   โโโ Queries SQL
    โ       โโโ get_old_requests_to_archive()
    โ       โโโ archive_requests_batch()
    โ       โโโ get_expired_notifications()
    โ
    โโโ approval_cleanup_analytics.py
    โ   โโโ Anรกlisis y mรฉtricas
    โ       โโโ detect_anomaly()
    โ       โโโ calculate_percentiles()
    โ       โโโ analyze_trends()
    โ
    โโโ approval_cleanup_utils.py
        โโโ Utilidades
            โโโ log_with_context()
            โโโ validate_params()
            โโโ export_to_multiple_formats()
```

### Flujo del DAG de Aprobaciones

```
โโโโโโโโโโโโโโโโโโโโโโโ
โ Validaciรณn de       โ
โ   Parรกmetros        โ
โโโโโโโโโโโโฌโโโโโโโโโโโ
           โ
           โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ Archivado de        โ
โ Solicitudes Antiguasโ
โโโโโโโโโโโโฌโโโโโโโโโโโ
           โ
           โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ Limpieza de         โ
โ Notificaciones      โ
โ   Expiradas         โ
โโโโโโโโโโโโฌโโโโโโโโโโโ
           โ
           โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ Optimizaciรณn de     โ
โ      รndices        โ
โโโโโโโโโโโโฌโโโโโโโโโโโ
           โ
           โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ Anรกlisis y          โ
โ     Reportes        โ
โโโโโโโโโโโโฌโโโโโโโโโโโ
           โ
           โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ Monitoreo y         โ
โ     Alertas         โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Flujo de ETL

### Pipeline ETL Completo

```
โโโโโโโโโโโโโโโ
โ   Fuente    โ
โ   (API/DB)  โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ   Extract   โ
โ  (Extraer)  โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ  Transform  โ
โ(Transformar)โ
โ  โโโโโโโโโโ โ
โ  โValidarโ โ
โ  โLimpiarโ โ
โ  โEnriquecerโ
โ  โโโโโโโโโโ โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ    Load     โ
โ  (Cargar)   โ
โ  โโโโโโโโโโ โ
โ  โPostgreSQLโ
โ  โ   S3    โ
โ  โ  Kafka  โ
โ  โโโโโโโโโโ โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ  Quality    โ
โ   Checks   โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ  Notify     โ
โ  (Success/  โ
โ   Failure)  โ
โโโโโโโโโโโโโโโ
```

---

## โธ๏ธ Arquitectura de Kubernetes

### Topologรญa del Cluster

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Kubernetes Cluster                     โ
โ                                                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ              Control Plane                       โ   โ
โ  โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ   โ
โ  โ  โ   API    โ  โScheduler โ  โControllerโ      โ   โ
โ  โ  โ Server   โ  โ          โ  โ Manager โ      โ   โ
โ  โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ              Worker Nodes                        โ   โ
โ  โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ   โ
โ  โ  โ  Node 1  โ  โ  Node 2  โ  โ  Node 3  โ      โ   โ
โ  โ  โ          โ  โ          โ  โ          โ      โ   โ
โ  โ  โ  Pods:   โ  โ  Pods:   โ  โ  Pods:   โ      โ   โ
โ  โ  โ - Airflowโ  โ - Kestra โ  โ - MLflow โ      โ   โ
โ  โ  โ - Workersโ  โ - Workersโ  โ - KServe โ      โ   โ
โ  โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ              Storage Layer                        โ   โ
โ  โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ   โ
โ  โ  โ  PVCs    โ  โ  Secrets  โ  โ ConfigMapsโ     โ   โ
โ  โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ      โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Namespaces y Componentes

```
Kubernetes Cluster
โ
โโโ Namespace: airflow
โ   โโโ Deployment: airflow-webserver
โ   โโโ Deployment: airflow-scheduler
โ   โโโ StatefulSet: airflow-workers
โ   โโโ Service: airflow-webserver
โ
โโโ Namespace: workflow
โ   โโโ Deployment: kestra
โ   โโโ Deployment: flowable
โ   โโโ Deployment: camunda
โ
โโโ Namespace: ml
โ   โโโ Deployment: mlflow
โ   โโโ Deployment: kserve
โ   โโโ Deployment: kubeflow
โ
โโโ Namespace: observability
โ   โโโ Deployment: prometheus
โ   โโโ Deployment: grafana
โ   โโโ Deployment: loki
โ
โโโ Namespace: security
    โโโ Deployment: vault
    โโโ Deployment: external-secrets
```

---

## ๐ Flujo de ML Pipeline

```
โโโโโโโโโโโโโโโ
โ Data        โ
โ Ingestion   โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ Feature     โ
โ Engineering โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ Model       โ
โ Training    โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ Model       โ
โ Evaluation  โ
โโโโโโโโฌโโโโโโโ
       โ
    โโโโดโโโ
    โ     โ
    โผ     โผ
โโโโโโโ โโโโโโโโโโโโโโโโ
โMรฉtricasโ โMรฉtricas     โ
โ  OK   โ โInsuficientesโ
โโโโโฌโโโ โโโโโโโโฌโโโโโโโโ
    โ           โ
    โ           โผ
    โ      โโโโโโโโโโโโโโโ
    โ      โ Retraining  โ
    โ      โโโโโโโโฌโโโโโโโ
    โ             โ
    โ             โโโโโ
    โ                 โ
    โผ                 โผ
โโโโโโโโโโโโโโโ
โ Registrationโ
โ  (MLflow)   โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ Deployment  โ
โ  (KServe)   โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ Monitoring  โ
โ & Drift     โ
โ Detection   โ
โโโโโโโโโโโโโโโ
```

---

## ๐ Diagrama de Observabilidad

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  Observability Stack                      โ
โ                                                           โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โ
โ  โ Applications โ  โ  Services   โ  โ  Kubernetes  โ  โ
โ  โ              โ  โ              โ  โ              โ  โ
โ  โโโโโโโโฌโโโโโโโโ  โโโโโโโโฌโโโโโโโโ  โโโโโโโโฌโโโโโโโโ  โ
โ         โ                 โ                 โ           โ
โ         โโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโ           โ
โ                           โ                             โ
โ                           โผ                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ              Prometheus                         โ   โ
โ  โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ     โ   โ
โ  โ  โ Metrics  โ  โ  Alerts  โ  โ  Rules   โ     โ   โ
โ  โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ     โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                           โ                             โ
โ                           โผ                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ              Grafana                            โ   โ
โ  โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ     โ   โ
โ  โ  โDashboardsโ  โ  Alerts  โ  โ  Explore โ     โ   โ
โ  โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ     โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ              Loki                                โ   โ
โ  โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ     โ   โ
โ  โ  โ  Logs    โ  โ  Labels  โ  โ  Queries โ     โ   โ
โ  โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ     โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Referencias

- [`docs/ARQUITECTURA.md`](./ARQUITECTURA.md) - Documentaciรณn de arquitectura
- [`docs/ESCALABILIDAD.md`](./ESCALABILIDAD.md) - Arquitectura de escalabilidad

---

**Versiรณn**: 1.0 | **Estado**: Producciรณn Ready โ  
**Mantenido por**: platform-team  
**รltima actualizaciรณn**: 2024

